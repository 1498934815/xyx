<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- 移动端适配：禁止缩放、适配屏幕宽度 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>太空射击游戏 - 优化增强版</title>
    
    <!-- 1. 引入CSS样式（按拆分后的css目录结构） -->
    <link rel="stylesheet" href="css/main.css"> <!-- 全局基础样式 -->
    <link rel="stylesheet" href="css/gameUI.css"> <!-- 游戏内UI样式（血条、弹窗等） -->
    <link rel="stylesheet" href="css/joystick.css"> <!-- 操作摇杆样式 -->
    
    <!-- 样式兜底：防止外部CSS加载失败导致界面错乱 -->
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Arial", "Microsoft YaHei", sans-serif; }
        body { width: 100vw; height: 100vh; overflow: hidden; background: #0a0e17; }
        #gameCanvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: block; }
        /* 核心UI基础样式 */
        .screen { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                  background: rgba(10,14,23,0.9); border: 2px solid #9b59b6; border-radius: 12px; 
                  padding: 30px; color: #fff; text-align: center; z-index: 20; }
        button { margin: 10px; padding: 12px 24px; background: #9b59b6; color: #fff; 
                 border: none; border-radius: 8px; font-size: 16px; cursor: pointer; 
                 transition: background 0.3s; }
        button:hover { background: #8e44ad; }
        .gameInfo { position: absolute; top: 10px; left: 10px; color: #fff; 
                    font-size: 14px; line-height: 1.8; z-index: 10; }
        .controlArea { position: absolute; bottom: 20px; width: 100%; display: flex; 
                       justify-content: space-between; padding: 0 20px; z-index: 10; }
    </style>
</head>
<body>
    <!-- 2. 游戏核心画布（拆分后由 core/GameLoop.js 驱动渲染） -->
    <canvas id="gameCanvas"></canvas>

    <!-- 3. 游戏UI容器（所有DOM元素ID与 ui/ 层模块对应） -->
    <div id="gameUI">
        <!-- 3.1 游戏信息区（对应 ui/GameInfoUI.js 管理） -->
        <div class="gameInfo">
            <div>分数: <span id="score">0</span></div>
            <div>生命: <span id="lives">3</span></div>
            <div>等级: <span id="level">1</span></div>
            <div>升级所需: <span id="nextLevel">100</span>分</div>
            <div>BOSS倒计时: <span id="bossTime">90</span>秒</div>
            <div>射速: <span id="fireRate">300</span>ms/发</div>
        </div>

        <!-- 3.2 BOSS专属UI（对应 ui/BossUI.js 管理） -->
        <div class="bossUI">
            <div id="bossHealthBar" style="display: none;"> <!-- BOSS血条容器 -->
                <div id="bossHealthFill" style="width: 100%; height: 100%; background: #e74c3c;"></div>
            </div>
            <div id="bossName" style="display: none; color: #fff; text-align: center; font-size: 18px; margin-top: 10px;"></div>
            <div id="bossWarning" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                                        color: #ff0; font-size: 24px; font-weight: bold; z-index: 15;">
                ⚠️ BOSS即将出现！⚠️
            </div>
        </div>

        <!-- 3.3 技能选择弹窗（对应 ui/PopupUI.js 管理） -->
        <div id="skillSelectPopup" class="screen" style="display: none;">
            <h3>选择一个技能</h3>
            <button id="skill1" class="skillBtn">穿透子弹<br><small>子弹可穿透1个敌人</small></button>
            <button id="skill2" class="skillBtn">护盾防御<br><small>免疫1次伤害</small></button>
            <button id="skill3" class="skillBtn">速度提升<br><small>移动速度+30%</small></button>
        </div>

        <!-- 3.4 页面弹窗（开始/设置/游戏结束，对应 ui/SettingUI.js + ui/PopupUI.js 管理） -->
        <div class="pagePopups">
            <!-- 开始页面 -->
            <div id="startScreen" class="screen">
                <h1>太空射击游戏</h1>
                <ul style="text-align: left; margin: 20px 0; padding-left: 20px;">
                    <li>• 左侧摇杆控制移动，右侧按钮射击</li>
                    <li>• 升级提升射速，每2级可选1个技能</li>
                    <li>• 击败BOSS获得高额奖励，注意躲避技能</li>
                </ul>
                <button id="startButton">开始游戏</button>
                <button id="settingsButton">游戏设置</button>
            </div>

            <!-- 设置页面 -->
            <div id="settingsScreen" class="screen" style="display: none;">
                <h2>游戏设置</h2>
                <div style="margin: 20px 0; text-align: left;">
                    <label style="display: block; margin: 10px 0;"><input type="checkbox" id="autoFireToggle"> 自动射击</label>
                    <label style="display: block; margin: 10px 0;"><input type="checkbox" id="fixedJoystickToggle"> 固定摇杆</label>
                    <label style="display: block; margin: 10px 0;"><input type="checkbox" id="soundToggle" checked> 音效开关</label>
                </div>
                <button id="backToStartButton">返回</button>
            </div>

            <!-- 游戏结束页面 -->
            <div id="gameOverScreen" class="screen" style="display: none;">
                <h2>游戏结束</h2>
                <div style="margin: 20px 0; line-height: 1.8;">
                    <p>最终得分: <span id="finalScore">0</span></p>
                    <p>最高等级: <span id="finalLevel">1</span></p>
                    <p>击败BOSS数量: <span id="bossKilled">0</span></p>
                </div>
                <button id="restartButton">再玩一次</button>
            </div>
        </div>

        <!-- 3.5 操作控制区（对应 ui/ControlUI.js 管理） -->
        <div class="controlArea">
            <!-- 左侧移动摇杆 -->
            <div id="joystick" style="width: 80px; height: 80px; border: 2px solid #fff; border-radius: 50%; position: relative;">
                <div id="joystickHandle" style="width: 30px; height: 30px; background: #9b59b6; border-radius: 50%; 
                                               position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);"></div>
            </div>
            <!-- 右侧功能按钮 -->
            <div>
                <button id="shootBtn">射击</button>
                <button id="skillBtn" style="margin-left: 10px; background: #3498db;">技能</button>
            </div>
        </div>
    </div>

    <!-- 4. 按拆分后的目录顺序引入JS脚本（核心！确保依赖正确） -->
    <!-- 4.1 配置层（1.config/：纯数据，无依赖） -->
    <script src="js/config/GameGlobalConfig.js"></script>
    <script src="js/config/PlayerConfig.js"></script>
    <script src="js/config/BossConfig.js"></script>
    <script src="js/config/EnemyConfig.js"></script>
    <script src="js/config/SkillConfig.js"></script>

    <!-- 4.2 工具层（2.util/：独立工具，无业务依赖） -->
    <script src="js/util/DomUtil.js"></script>
    <script src="js/util/MathUtil.js"></script>
    <script src="js/util/ParticleUtil.js"></script>
    <script src="js/util/TouchUtil.js"></script>

    <!-- 4.3 核心层（3.core/：游戏运行基础，依赖配置+工具） -->
    <script src="js/core/GameState.js"></script>
    <script src="js/core/ObjectPool.js"></script>
    <script src="js/core/EventBus.js"></script>
    <script src="js/core/GameLoop.js"></script>

    <!-- 4.4 模块层（4.module/：游戏核心功能，依赖核心层） -->
    <!-- 玩家子模块 -->
    <script src="js/module/player/Player.js"></script>
    <script src="js/module/player/PlayerFireSystem.js"></script>
    <script src="js/module/player/PlayerSkillSystem.js"></script>
    <!-- BOSS子模块 -->
    <script src="js/module/boss/BossManager.js"></script>
    <script src="js/module/boss/BossAttackSystem.js"></script>
    <script src="js/module/boss/BossSkillSystem.js"></script>
    <script src="js/module/boss/BossDropSystem.js"></script>
    <!-- 通用子模块 -->
    <script src="js/module/common/EnemyManager.js"></script>
    <script src="js/module/common/AchievementManager.js"></script>
    <script src="js/module/common/SoundManager.js"></script>

    <!-- 4.5 UI层（5.ui/：界面控制，依赖工具+核心层） -->
    <script src="js/ui/UIManager.js"></script>
    <script src="js/ui/GameInfoUI.js"></script>
    <script src="js/ui/BossUI.js"></script>
    <script src="js/ui/PopupUI.js"></script>
    <script src="js/ui/SettingUI.js"></script>
    <script src="js/ui/ControlUI.js"></script>

    <!-- 4.6 入口层（6.entry/：最后加载，初始化所有模块） -->
    <script src="js/entry/GameMain.js"></script>

    <!-- 5. 页面加载完成后初始化（避免DOM未就绪导致错误） -->
    <script>
        window.addEventListener('load', function() {
            // 初始化画布大小（适配窗口，同步到全局配置）
            const canvas = DomUtil.getElement('gameCanvas'); // 调用 util/DomUtil.js 的工具方法
            const resizeCanvas = () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                GameGlobalConfig.canvas.width = canvas.width; // 同步到 1.config/GameGlobalConfig.js
                GameGlobalConfig.canvas.height = canvas.height;
            };
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            // 启动游戏（调用入口层 6.entry/GameMain.js 的初始化方法）
            if (typeof GameMain !== 'undefined' && typeof GameMain.init === 'function') {
                GameMain.init();
            } else {
                console.error('游戏入口模块未加载，请检查 6.entry/GameMain.js 路径！');
            }
        });
    </script>
</body>
</html>
